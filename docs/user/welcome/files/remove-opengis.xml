<?xml version="1.0" encoding="utf-8"?>
<project name="remove-opengis" default="update">

    <property name="project.dir" location="."/>
    
    <target name="update" depends="code,services"
        description="Update project in current directory to remove org.opengis package use">
        
        <echo/>
        <echo>Your project ${project.dir} has been updated to remove references to org.opengis</echo>
        <echo>You may have unsued imports to clean up, but we believe your project will compile!</echo>
    </target>
    
    <target name="bounds"
        description="Bounds and Position API cleanup">
       <fileset id="bounds.files" dir="${project.dir}" includes="**/*.java">
            <contains text="import org.geotools.api.geometry.Envelope;" casesensitive="yes"/>
        </fileset>
        <echo message="Files containing org.geotools.api.geometry.Envelope: ${toString:bounds.files}" />

        <replaceregexp byline="true">
          <fileset refid="bounds.files"/>
          <regexp pattern="(\s)Envelope"/>
          <substitution expression="\1Bounds"/>
        </replaceregexp>
        
        <replacefilter>
          <fileset refid="bounds.files"/>
          <replacetoken>import org.geotools.api.geometry.Envelope;</replacetoken>
          <replacevalue>import org.geotools.api.geometry.Bounds;</replacevalue>
        </replacefilter>
    </target>
    
    <target name="code"
        description="Update Java files, replacing imports and refernces to org.opengis classes">
        
        <echo>Updating ${project.dir} java files ...</echo>
        <echo/>
        <!-- bulk repalce * imports, may require more than one * import -->
        <replace dir="${project.dir}" summary="yes">
          <include name="**/*.java"/>
          <replacefilter>
            <replacetoken>import org.opengis.annotation.*;</replacetoken>
            <replacevalue>// documentation annotations no-longer available</replacevalue>
          </replacefilter>
          <replacefilter>
            <replacetoken>org.opengis.</replacetoken>
            <replacevalue>org.geotools.api.</replacevalue>
          </replacefilter>
        </replace>
        
        
        <!--                                                       -->
        <!-- COVERAGE                                              -->
        <!--                                                       -->
        <!--
        <replacefilter>
          <replacetoken>import org.opengis.coverage.*;</replacetoken>
          <replacevalue>import org.geotools.coverage.*;</replacevalue>
        </replacefilter>
        <replacefilter>
          <replacetoken>import org.opengis.coverage.grid.*;</replacetoken>
          <replacevalue>import org.geotools.coverage.grid.*;</replacevalue>
        </replacefilter>
        <replacefilter>
          <replacetoken>import org.opengis.coverage.processing.*;</replacetoken>
          <replacevalue>import org.geotools.coverage.processing.*;</replacevalue>
        </replacefilter>
        <replacefilter>
          <replacetoken>import org.opengis.coverage.processing.GridCoverageProcessor;</replacetoken>
          <replacevalue>// GridCoverageProcessor removed used CoverageProcessor</replacevalue>
        </replacefilter>
        <replacefilter>
          <replacetoken>org.opengis.coverage.processing.Operation</replacetoken>
          <replacevalue>org.geotools.coverage.processing.Operation</replacevalue>
        </replacefilter>
        -->

        <!--                                                       -->
        <!-- FEATURE                                               -->
        <!--                                                       -->
        <!--
        <replacefilter>
          <replacetoken>import org.opengis.feature.*;</replacetoken>
          <replacevalue>import org.geotools.feature.*;</replacevalue>
        </replacefilter>
        
        
        <replacefilter>
          <replacetoken>import org.opengis.feature.simple.*;</replacetoken>
          <replacevalue>import org.geotools.feature.simple.*;</replacevalue>
        </replacefilter>
        <replacefilter>
          <replacetoken>org.opengis.feature.simple.SimpleFeature</replacetoken>
          <replacevalue>org.geotools.feature.simple.SimpleFeature</replacevalue>
        </replacefilter>
        <replacefilter>
          <replacetoken>org.opengis.feature.simple.SimpleFeatureType</replacetoken>
          <replacevalue>org.geotools.feature.simple.SimpleFeatureType</replacevalue>
        </replacefilter>
        
        <replacefilter>
          <replacetoken>import org.opengis.feature.type.*;</replacetoken>
          <replacevalue>import org.geotools.feature.type.*;</replacevalue>
        </replacefilter>
        <replacefilter>
          <replacetoken>org.opengis.feature.type.AssociationDescriptor</replacetoken>
          <replacevalue>org.geotools.feature.type.AssociationDescriptor</replacevalue>
        </replacefilter>
        <replacefilter>
          <replacetoken>org.opengis.feature.type.AssociationType</replacetoken>
          <replacevalue>org.geotools.feature.type.AssociationType</replacevalue>
        </replacefilter>
        <replacefilter>
          <replacetoken>org.opengis.feature.type.AttributeDescriptor</replacetoken>
          <replacevalue>org.geotools.feature.type.AttributeDescriptor</replacevalue>
        </replacefilter>
        <replacefilter>
          <replacetoken>org.opengis.feature.type.AttributeType</replacetoken>
          <replacevalue>org.geotools.feature.type.AttributeType</replacevalue>
        </replacefilter>
        <replacefilter>
          <replacetoken>org.opengis.feature.type.ComplexType</replacetoken>
          <replacevalue>org.geotools.feature.type.ComplexType</replacevalue>
        </replacefilter>
        -->

        <!--                                                       -->
        <!-- FILTER                                                -->
        <!--                                                       -->
        <!--
        <replacefilter>
          <replacetoken>import org.opengis.filter.*;</replacetoken>
          <replacevalue>import org.geotools.filter.*;</replacevalue>
        </replacefilter>
        
        <replacefilter>
          <replacetoken>import org.opengis.filter.*;</replacetoken>
          <replacevalue>import org.geotools.filter.*;</replacevalue>
        </replacefilter>
        
        <replacefilter>
          <replacetoken>import org.opengis.style.*;</replacetoken>
          <replacevalue>import org.geotools.styling.*;</replacevalue>
        </replacefilter>
        -->
     </target>
     
     <target name="services" description="Update META-INF/services to migrate org.opengis services">
        <echo>Updating ${project.dir} META-INF/services ...</echo>
        <echo/>
        <!-- Service INF -->
        <move todir="." verbose="true">
          <fileset dir=".">
             <include name="**/META-INF/services/org.opengis.*"/>
             <exclude name="**/target/*"/>
          </fileset>
          <regexpmapper from="(.*)/org.opengis.(.*)" to="\1/org.geotools.api.\2"/>
        </move>
     </target>
    
</project>